<!DOCTYPE html>
<html>

<head>
  <title></title>
  <style type="text/css">
    html,
    body {
		margin: 0;
		padding: 0;
		height: 100%;
    }
	#simle-plus{
		height:100%;overflow-y: hidden;
		display: flex;
	}
	#editor
	{
		border:0px solid;
		width:100%; 
		height:100%;
		resize: none;
		font-family: monospace;
		overflow-y: scroll;    
		outline: none;     
		font-size: 17px;
		padding: 7px;
		flex: 1 1 0%;
		line-height: inherit;
		margin: 0;
	}
  </style>
</head>

<body>

  <div id="simle-plus" >
    <textarea id="editor">123456789
Ctr + D = new Note or Toggle status on cursor
Ctr + Enter = new Note under cursor
Line 3
Line 4</textarea>
  </div>

  <script>
  
	var check = convertHexToString('e29c94');
	var box   = convertHexToString('e29890');
	var strikethrough = convertHexToString('ccb6')
	
	String.prototype.setCharAt=function(index, chr)
        {
            if (index > this.length - 1) return this;
            return this.substr(0, index) + chr + this.substr(index + 1);
        }
	String.prototype.replaceAll = function(search, replacement) {
		var target = this;
		return target.replace(new RegExp(search, 'g'), replacement);
	};
    String.prototype.replaceAt = function(index, replacement) {
      return this.substr(0, index) + replacement + this.substr(index + replacement.length);
    } //alert(hello.replaceAt(2, "!!")); //should display He!!o World

	String.prototype.findNext = function(start, search) {
		for(var i = start; i<this.length;i++)
		{
			if(this[i]==search)
				return i;
		}
        return this.length;
    } 
	
	String.prototype.findPref = function(start, search) {
		for(var i = start-1; i>=0;i--)
		{
			if(this[i]==search)
				return i;
		}
        return 0;
    } 
	
	
	String.prototype.replaceFirstInArea = function(Start,End, search, replacement) {
		for(var i = Start; i<End;i++)
		{
			if(this[i] == search)
			{
				return this.replaceAt(i,replacement);
			}
		}
		return this;
    } 
	
	String.prototype.toggleFirstInArea = function(Start,End, search, replacement) {
	
		var lastTabOrSpace = 0;
		var found = false;
		for(var i = Start; i<End;i++)
		{
			if((this[i] == " " || this[i] == "\t")&& !found)
			{
				lastTabOrSpace = i+1;
				continue;
			}
			found = true;
			if(this[i] == search)
			{	
				//var strToStrike = this.substring(i+1, End);
				var str = this;
				str = str.replaceAll(strikethrough,'');
				return str.replaceAt(i,replacement);
			}
			if(this[i] == replacement)
			{
				var str = this;
				for(var j = i+2; j<End*2;j+=2)
				{
					str = str.InsertAt(strikethrough,j);
				}
				return str.replaceAt(i,search);
			}
		}
		return this.InsertAt(box+" ",lastTabOrSpace);
    } 
	
	
    String.prototype.InsertAt = function(CharToInsert, Position) {
      return this.slice(0, Position) + CharToInsert + this.slice(Position)
    } //"20160923".InsertAt('-',4); //Output :"2016-0923"

    function convertHexToString(input) {

      // split input into groups of two
      var hex = input.match(/[\s\S]{2}/g) || [];
      var output = '';

      // build a hex-encoded representation of your string
      for (var i = 0, j = hex.length; i < j; i++) {
        output += '%' + ('0' + hex[i]).slice(-2);
      }

      // decode it using this trick
      output = decodeURIComponent(output);

      return output;
    }


    document.addEventListener("DOMContentLoaded", function(event) {
      var editor = document.getElementById("editor");
	//
	  //================Standardnote Stuff========================
      window.addEventListener("message", function(event) {
        console.log(event);
        if (event.data.id) {
          window.noteText = event.data.text || "";
          window.noteId = event.data.id;
          editor.value = window.noteText;
        }
      }, false);
      if (window.parent != window) {
        window.parent.postMessage({
          status: "ready"
        }, '*');
      }
      document.getElementById("editor").addEventListener("input", function(event) {
        if (window.parent != window) {
          var text = editor.value || "";
          window.parent.postMessage({
            text: text,
            id: window.noteId
          }, '*');
        }
      });
	  //================Standardnote Stuff========================
	  
	  
	  
	  
	function editorInfos(editor){
		var str = editor.value;
		var indices = [];
		for (var i = 0; i < editor.selectionStart; i++) {
			if (str[i] === "\n") indices.push(i);
		}
		return indices;
	}

	document.addEventListener('keydown', function(e) {
		 if (e.ctrlKey && e.keyCode == 13) { 
		 
		 editor.selectionStart = editor.selectionEnd = editor.selectionStart +2;
		 }
	 });
	
    editor.addEventListener('keydown', function(e) {

		if (e.ctrlKey&& e.keyCode == 68){//Str + D
			e.preventDefault();
			var cursor = editor.selectionStart;
			var str = editor.value;
			var indices = editorInfos(editor);
			var lines = str.split('\n');
			var targetRow= lines[indices.length];
			var newRow = targetRow.toggleFirstInArea(0,targetRow.length-1,check,box);
			lines[indices.length] = newRow;

			var text = "";
			lines.forEach(function(l){
			text+= l+"\n";
			});
			editor.value = text;
			editor.selectionStart = editor.selectionEnd = cursor;
		}
	  
        if (e.ctrlKey && e.keyCode == 13) { //Str + Enter
		 console.log("down");
			//todo: first jump tonew Line without breaking at cursor position
			
			//editor.selectionStart = editor.selectionEnd =  editor.selectionStart+1;
			
			//var nextLineBreak = editor.value.findNext(editor.selectionStart-1,"\n");
			//var prefLineBreak = editor.value.findPref(editor.selectionStart-1,"\n");
			
			
			//for(var i = prefLineBreak; i< nextLineBreak; i++){
			//	if(editor.value[i]== "\n");
			//		editor.value = editor.value.setCharAt(i,"");
			//}
			
			
			//remove Linebreak
			var cPos = editor.selectionStart;
			var nextLineBreak = editor.value.findNext(cPos,"\n");
			//editor.value = editor.value.setCharAt(nextLineBreak,"");
			//editor.selectionStart = editor.selectionEnd = cPos-1;
			
			
			
			editor.value = editor.value.InsertAt(box+" ", nextLineBreak);
			
			editor.selectionStart = editor.selectionEnd = nextLineBreak;
		
		
        }

      }, false);


tabOverride.set(editor);
	  
    });
  </script>


  <script>
    /*! taboverride v4.0.3 | https://github.com/wjbryant/taboverride
(c) 2015 Bill Bryant | http://opensource.org/licenses/mit */
!function(a){"use strict";var b;"object"==typeof exports?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):(b=window.tabOverride={},a(b))}(function(a){"use strict";function b(a,b){var c,d,e,f=["alt","ctrl","meta","shift"],g=a.length,h=!0;for(c=0;g>c;c+=1)if(!b[a[c]]){h=!1;break}if(h)for(c=0;c<f.length;c+=1){if(e=f[c]+"Key",b[e])if(g){for(h=!1,d=0;g>d;d+=1)if(e===a[d]){h=!0;break}}else h=!1;if(!h)break}return h}function c(a,c){return a===q&&b(s,c)}function d(a,c){return a===r&&b(t,c)}function e(a,b){return function(c,d){var e,f="";if(arguments.length){if("number"==typeof c&&(a(c),b.length=0,d&&d.length))for(e=0;e<d.length;e+=1)b.push(d[e]+"Key");return this}for(e=0;e<b.length;e+=1)f+=b[e].slice(0,-3)+"+";return f+a()}}function f(a){a=a||event;var b,e,f,g,h,i,j,k,l,s,t,w,x,y,z,A,B,C,D=a.currentTarget||a.srcElement,E=a.keyCode,F="character";if((!D.nodeName||"textarea"===D.nodeName.toLowerCase())&&(E===q||E===r||13===E&&u)){if(v=!1,f=D.value,k=D.scrollTop,"number"==typeof D.selectionStart)l=D.selectionStart,s=D.selectionEnd,t=f.slice(l,s);else{if(!o.selection)return;g=o.selection.createRange(),t=g.text,h=g.duplicate(),h.moveToElementText(D),h.setEndPoint("EndToEnd",g),s=h.text.length,l=s-t.length,n>1?(i=f.slice(0,l).split(m).length-1,j=t.split(m).length-1):i=j=0}if(E===q||E===r)if(b=p,e=b.length,y=0,z=0,A=0,l!==s&&-1!==t.indexOf("\n"))if(w=0===l||"\n"===f.charAt(l-1)?l:f.lastIndexOf("\n",l-1)+1,s===f.length||"\n"===f.charAt(s)?x=s:"\n"===f.charAt(s-1)?x=s-1:(x=f.indexOf("\n",s),-1===x&&(x=f.length)),c(E,a))y=1,D.value=f.slice(0,w)+b+f.slice(w,x).replace(/\n/g,function(){return y+=1,"\n"+b})+f.slice(x),g?(g.collapse(),g.moveEnd(F,s+y*e-j-i),g.moveStart(F,l+e-i),g.select()):(D.selectionStart=l+e,D.selectionEnd=s+y*e,D.scrollTop=k);else{if(!d(E,a))return;0===f.slice(w).indexOf(b)&&(w===l?t=t.slice(e):A=e,z=e),D.value=f.slice(0,w)+f.slice(w+A,l)+t.replace(new RegExp("\n"+b,"g"),function(){return y+=1,"\n"})+f.slice(s),g?(g.collapse(),g.moveEnd(F,s-z-y*e-j-i),g.moveStart(F,l-A-i),g.select()):(D.selectionStart=l-A,D.selectionEnd=s-z-y*e)}else if(c(E,a))g?(g.text=b,g.select()):(D.value=f.slice(0,l)+b+f.slice(s),D.selectionEnd=D.selectionStart=l+e,D.scrollTop=k);else{if(!d(E,a))return;0===f.slice(l-e).indexOf(b)&&(D.value=f.slice(0,l-e)+f.slice(l),g?(g.move(F,l-e-i),g.select()):(D.selectionEnd=D.selectionStart=l-e,D.scrollTop=k))}else if(u){if(0===l||"\n"===f.charAt(l-1))return void(v=!0);if(w=f.lastIndexOf("\n",l-1)+1,x=f.indexOf("\n",l),-1===x&&(x=f.length),B=f.slice(w,x).match(/^[ \t]*/)[0],C=B.length,w+C>l)return void(v=!0);g?(g.text="\n"+B,g.select()):(D.value=f.slice(0,l)+"\n"+B+f.slice(s),D.selectionEnd=D.selectionStart=l+n+C,D.scrollTop=k)}return a.preventDefault?void a.preventDefault():(a.returnValue=!1,!1)}}function g(a){a=a||event;var b=a.keyCode;if(c(b,a)||d(b,a)||13===b&&u&&!v){if(!a.preventDefault)return a.returnValue=!1,!1;a.preventDefault()}}function h(a,b){var c,d=x[a]||[],e=d.length;for(c=0;e>c;c+=1)d[c].apply(null,b)}function i(a){function b(b){for(c=0;f>c;c+=1)b(a[c].type,a[c].handler)}var c,d,e,f=a.length;return o.addEventListener?(d=function(a){b(function(b,c){a.removeEventListener(b,c,!1)})},e=function(a){d(a),b(function(b,c){a.addEventListener(b,c,!1)})}):o.attachEvent&&(d=function(a){b(function(b,c){a.detachEvent("on"+b,c)})},e=function(a){d(a),b(function(b,c){a.attachEvent("on"+b,c)})}),{add:e,remove:d}}function j(a){h("addListeners",[a]),l.add(a)}function k(a){h("removeListeners",[a]),l.remove(a)}var l,m,n,o=window.document,p="\t",q=9,r=9,s=[],t=["shiftKey"],u=!0,v=!1,w=o.createElement("textarea"),x={};l=i([{type:"keydown",handler:f},{type:"keypress",handler:g}]),w.value="\n",m=w.value,n=m.length,w=null,a.utils={executeExtensions:h,isValidModifierKeyCombo:b,createListeners:i,addListeners:j,removeListeners:k},a.handlers={keydown:f,keypress:g},a.addExtension=function(a,b){return a&&"string"==typeof a&&"function"==typeof b&&(x[a]||(x[a]=[]),x[a].push(b)),this},a.set=function(a,b){var c,d,e,f,g,i,l;if(a)for(c=arguments.length<2||b,d=a,e=d.length,"number"!=typeof e&&(d=[d],e=1),c?(f=j,g="true"):(f=k,g=""),i=0;e>i;i+=1)l=d[i],l&&l.nodeName&&"textarea"===l.nodeName.toLowerCase()&&(h("set",[l,c]),l.setAttribute("data-taboverride-enabled",g),f(l));return this},a.tabSize=function(a){var b;if(arguments.length){if(a&&"number"==typeof a&&a>0)for(p="",b=0;a>b;b+=1)p+=" ";else p="\t";return this}return"\t"===p?0:p.length},a.autoIndent=function(a){return arguments.length?(u=a?!0:!1,this):u},a.tabKey=e(function(a){return arguments.length?void(q=a):q},s),a.untabKey=e(function(a){return arguments.length?void(r=a):r},t)});
//# sourceMappingURL=taboverride.min.js.map
  </script>


</body>

</html>